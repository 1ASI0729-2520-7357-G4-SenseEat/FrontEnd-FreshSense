<section class="wrap">
    <div class="status card">
        <div class="left">
            <div class="dot online"></div>
            <div>
                <strong>{{ 'monitoring.status.healthy' | translate }}</strong>
                <div class="muted">{{ 'monitoring.lastSync' | translate:{ minutes: lastSyncMinutes } }}</div>
            </div>
        </div>
        <div class="kpi-row">
            <div class="kpi"><span class="kpi__label">{{ 'monitoring.kpi.openIssues' | translate }}</span><span class="kpi__val">{{ kpi.issues() }}</span></div>
            <div class="kpi"><span class="kpi__label">{{ 'monitoring.kpi.avgHumidity' | translate }}</span><span class="kpi__val">{{ kpi.avgHumidity() }}%</span></div>
            <div class="kpi"><span class="kpi__label">{{ 'monitoring.kpi.avgTemp' | translate }}</span><span class="kpi__val">{{ kpi.avgTemp() }}Â°C</span></div>
        </div>
    </div>

    <div class="filters">
        <span class="muted">{{ 'monitoring.category' | translate }}:</span>
        <button class="chip" *ngFor="let c of categories" [class.active]="activeCategory()===c" (click)="setCategory(c)">
            {{ c }}
        </button>
    </div>

    <h2 class="h1">{{ 'monitoring.title' | translate }}</h2>

    <div class="grid">
        <article class="card tile" *ngFor="let c of cards()" [ngClass]="{ 'is-progress': c.kind === 'progress' }">
            <div class="tile__head">
                <div class="tile__icon">ðŸ’§</div>
                <div class="tile__title">{{ c.title }}</div>
                <span class="badge" [ngClass]="badgeClass(c)">{{ badgeClass(c) }}</span>
            </div>

            <div class="tile__body" *ngIf="c.kind==='metric'">
                <div class="metric"><strong>{{ c.value }}{{ c.unit ?? '' }}</strong></div>
                <div class="muted" *ngIf="c.subtitle">{{ c.subtitle }}</div>
                <svg class="spark" viewBox="0 0 120 36" *ngIf="c.trend?.length"><polyline [attr.points]="sparkPoints(c.trend)" /></svg>
            </div>

            <div class="tile__body" *ngIf="c.kind==='progress'">
                <div class="progress"><span [style.width.%]="c.valuePct || 0"></span></div>
                <div class="muted">{{ c.valuePct }}%</div>
                <svg class="spark" viewBox="0 0 120 36" *ngIf="c.trend?.length"><polyline [attr.points]="sparkPoints(c.trend)" /></svg>
            </div>
        </article>

        <article class="card history span-12">
            <div class="history__head">
                <h4 class="h2">{{ 'monitoring.history.title' | translate }}</h4>
                <a class="btn ghost" href="#">{{ 'monitoring.exportCsv' | translate }}</a>
            </div>
            <div class="history__box">
                <div>
                    <div class="muted">{{ 'monitoring.history.last' | translate:{ date: lastMonitoringDate } }}</div>
                    <strong>{{ lastMonitoringDate }}</strong>
                </div>
                <a class="btn primary" href="#">{{ 'monitoring.viewLast' | translate }}</a>
            </div>
        </article>
    </div>
</section>
