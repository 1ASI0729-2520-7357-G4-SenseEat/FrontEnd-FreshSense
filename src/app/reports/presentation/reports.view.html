<section class="wrap">
    <header class="head">
        <h2 class="h1">Reports</h2>

        <div class="filters">
            <label class="input">
                <span>From</span>
                <input type="date" [(ngModel)]="fromDate">
            </label>
            <label class="input">
                <span>To</span>
                <input type="date" [(ngModel)]="toDate">
            </label>
            <button class="btn" (click)="applyRange()">Apply</button>
        </div>
    </header>

    <div class="grid">
        <!-- Weekly food waste (bars) -->
        <article class="card span-8">
            <h3 class="h2">Weekly Food Waste</h3>
            <div class="bars">
                <div class="bar"
                     *ngFor="let d of days()"
                     [style.height.%]="(d.wasteKg / maxWaste) * 100">
                    <span class="bar__value">{{ d.wasteKg }}</span>
                    <span class="bar__label">{{ d.label }}</span>
                </div>
            </div>
        </article>

        <!-- KPIs -->
        <article class="card span-4">
            <div class="kpis">
                <div class="kpi">
                    <strong>Gain</strong>
                    <div class="kpi__value pos">+{{ gainPct }}%</div>
                    <small class="muted">vs last week</small>
                </div>
                <div class="kpi">
                    <strong>Loss</strong>
                    <div class="kpi__value neg">-{{ lossPct }}%</div>
                    <small class="muted">vs last week</small>
                </div>
                <div class="kpi">
                    <strong>Percentage Improvement</strong>
                    <div class="kpi__value pos">+{{ improvementPct }}%</div>
                    <small class="muted">month to date</small>
                </div>
            </div>
        </article>

        <!-- Trends (Humidity & Temperature) -->
        <article class="card span-12">
            <h3 class="h2">Trends</h3>
            <div class="legend">
                <span class="dot blue"></span> Humidity
                <span class="dot red"></span> Temperature
            </div>

            <svg class="chart" [attr.viewBox]="'0 0 ' + width + ' ' + height" role="img" aria-label="Trends">
                <!-- grid -->
                <g class="gridlines" *ngFor="let y of [0,25,50,75,100]">
                    <line [attr.x1]="pad" [attr.x2]="width-pad" [attr.y1]="yScale(y)" [attr.y2]="yScale(y)"></line>
                </g>
                <!-- humidity line -->
                <polyline class="hum" [attr.points]="polyline(humidity)"></polyline>
                <!-- temperature line -->
                <polyline class="temp" [attr.points]="polyline(temperature)"></polyline>
                <!-- x labels -->
                <g *ngFor="let d of days(); let i = index">
                    <text class="tick" [attr.x]="xScale(i)" [attr.y]="height-6">{{ d.label[0] }}</text>
                </g>
            </svg>
        </article>
    </div>
</section>
