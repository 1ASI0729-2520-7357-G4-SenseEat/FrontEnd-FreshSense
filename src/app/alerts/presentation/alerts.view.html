<section class="wrap">
    <header class="head">
        <h2 class="h1">Alerts</h2>

        <div class="filters">
            <div class="tabs">
                <button class="tab" *ngFor="let t of tabs" [class.active]="activeTab()===t.key" (click)="activeTab.set(t.key)">
                    {{ t.label }}
                </button>
            </div>

            <div class="row">
                <input class="search" type="search" placeholder="Search alertsâ€¦" [ngModel]="query()" (ngModelChange)="query.set($event)" />
                <select class="select" [ngModel]="sevFilter()" (ngModelChange)="sevFilter.set($event)">
                    <option value="all">All Severity</option>
                    <option value="critical">Critical</option>
                    <option value="warning">Warning</option>
                    <option value="info">Info</option>
                </select>
            </div>
        </div>
    </header>

    <div class="list" *ngIf="visible().length; else empty">
        <article class="alert-card" *ngFor="let a of visible()" [ngClass]="a.severity">
            <div class="alert__left">
                <div class="badge" [ngClass]="a.severity">{{ a.severity }}</div>
                <div class="source chip">{{ a.source }}</div>
            </div>

            <div class="alert__body">
                <div class="title-row">
                    <h3 class="title">{{ a.title }}</h3>
                    <div class="time muted">{{ a.timeAgo }}</div>
                </div>
                <p class="msg">{{ a.message }}</p>

                <div class="actions">
                    <button class="btn outline" (click)="mute(a)">Mute</button>
                    <button class="btn" (click)="resolve(a)">Resolve</button>
                    <button class="btn ghost" (click)="open(a)">Details</button>
                </div>

                <div class="drawer" *ngIf="isOpen(a)">
                    <div class="drawer__row"><span>Source</span><b>{{ a.source }}</b></div>
                    <div class="drawer__row"><span>Severity</span><b class="cap">{{ a.severity }}</b></div>
                    <div class="drawer__row"><span>State</span><b class="cap">{{ a.state }}</b></div>
                    <div class="drawer__row"><span>Last seen</span><b>{{ a.timeAgo }}</b></div>
                    <div class="drawer__foot">
                        <button class="btn ghost" (click)="close()">Close</button>
                        <button class="btn" (click)="resolve(a)">Mark as Resolved</button>
                    </div>
                </div>
            </div>
        </article>
    </div>

    <ng-template #empty>
        <div class="empty card">
            <h3>No alerts found</h3>
            <p class="muted">Try changing the tab, severity filter or your search.</p>
        </div>
    </ng-template>
</section>
